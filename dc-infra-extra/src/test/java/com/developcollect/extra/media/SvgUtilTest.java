package com.developcollect.extra.media;

import com.developcollect.core.utils.FileUtil;
import org.apache.batik.transcoder.TranscoderException;
import org.junit.Test;

import java.io.*;
import java.nio.charset.StandardCharsets;

import static org.junit.Assert.*;

public class SvgUtilTest {


    @Test
    public void test_toPng() throws IOException, TranscoderException {
        String svgRaw = "<svg width=\"380\" height=\"380\" viewBox=\"0 0 380 380\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><g id=\"dc-avatar-Background\">  <rect width=\"100%\" height=\"100%\" fill=\"#6BD9E9\" /></g><g id=\"dc-avatar-Base\"><g>  <g clip-path=\"url(#clip0)\">  <path d=\"M244 362.5C229.6 342.5 218.333 303.834 217 284.5L148.5 255L120 362.5H244Z\" fill=\"#AC6651\" stroke=\"black\" stroke-width=\"4\"/>  <mask id=\"mask0\" mask-type=\"alpha\" maskUnits=\"userSpaceOnUse\" x=\"120\" y=\"255\" width=\"124\" height=\"118\">  <path d=\"M244 372.5C229.6 352.5 218.333 303.834 217 284.5L148.5 255L120 372.5H244Z\" fill=\"#AC6651\"/>  </mask>  <g mask=\"url(#mask0)\">  <g style=\"mix-blend-mode:multiply\">  <ellipse cx=\"214\" cy=\"253\" rx=\"59\" ry=\"54\" fill=\"black\"/>  </g>  </g>  <mask id=\"path-4-inside-1\" fill=\"white\">  <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M273.887 193.917C273.86 193.802 273.832 193.686 273.804 193.57C273.777 193.454 273.749 193.339 273.72 193.223L257.324 124.786C257.307 124.718 257.291 124.651 257.275 124.583C257.259 124.515 257.242 124.447 257.226 124.379L257.153 124.076L257.152 124.076C246.934 82.6315 205.157 57.148 163.583 67.1088C122.009 77.0696 96.3164 118.718 105.989 160.294L105.987 160.294L122.979 231.212L122.993 231.209C133.595 272.113 175.063 297.15 216.33 287.262C257.598 277.375 283.217 236.265 274.132 194.997L274.145 194.994L273.887 193.917Z\"/>  </mask>  <path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M273.887 193.917C273.86 193.802 273.832 193.686 273.804 193.57C273.777 193.454 273.749 193.339 273.72 193.223L257.324 124.786C257.307 124.718 257.291 124.651 257.275 124.583C257.259 124.515 257.242 124.447 257.226 124.379L257.153 124.076L257.152 124.076C246.934 82.6315 205.157 57.148 163.583 67.1088C122.009 77.0696 96.3164 118.718 105.989 160.294L105.987 160.294L122.979 231.212L122.993 231.209C133.595 272.113 175.063 297.15 216.33 287.262C257.598 277.375 283.217 236.265 274.132 194.997L274.145 194.994L273.887 193.917Z\" fill=\"#AC6651\"/>  <path d=\"M273.887 193.917L269.993 194.832L269.995 194.841L269.997 194.849L273.887 193.917ZM273.72 193.223L269.831 194.155L269.833 194.164L269.835 194.173L273.72 193.223ZM257.324 124.786L253.431 125.708L253.434 125.718L257.324 124.786ZM257.226 124.379L253.336 125.311L253.339 125.322L257.226 124.379ZM257.153 124.076L261.043 123.144L260.112 119.256L256.223 120.186L257.153 124.076ZM257.152 124.076L253.268 125.034L254.219 128.89L258.082 127.967L257.152 124.076ZM163.583 67.1088L162.651 63.2189L163.583 67.1088ZM105.989 160.294L106.923 164.183L110.785 163.255L109.885 159.387L105.989 160.294ZM105.987 160.294L105.053 156.405L101.166 157.338L102.097 161.226L105.987 160.294ZM122.979 231.212L119.089 232.144L120.021 236.035L123.912 235.101L122.979 231.212ZM122.993 231.209L126.865 230.205L125.879 226.402L122.059 227.319L122.993 231.209ZM216.33 287.262L215.398 283.372H215.398L216.33 287.262ZM274.132 194.997L273.201 191.107L269.382 192.021L270.226 195.857L274.132 194.997ZM274.145 194.994L275.076 198.884L278.967 197.952L278.035 194.062L274.145 194.994ZM277.781 193.003C277.752 192.881 277.723 192.76 277.694 192.638L269.915 194.502C269.941 194.612 269.967 194.722 269.993 194.832L277.781 193.003ZM277.694 192.638C277.665 192.517 277.636 192.395 277.606 192.274L269.835 194.173C269.861 194.282 269.888 194.392 269.915 194.502L277.694 192.638ZM253.434 125.718L269.831 194.155L277.61 192.291L261.213 123.854L253.434 125.718ZM261.216 123.864C261.199 123.794 261.182 123.722 261.165 123.651L253.385 125.515C253.401 125.579 253.416 125.643 253.431 125.708L261.216 123.864ZM261.165 123.651C261.148 123.58 261.131 123.509 261.113 123.437L253.339 125.322C253.354 125.386 253.37 125.45 253.385 125.515L261.165 123.651ZM253.263 125.008L253.336 125.311L261.116 123.447L261.043 123.144L253.263 125.008ZM258.082 127.967L258.084 127.966L256.223 120.186L256.222 120.186L258.082 127.967ZM261.036 123.119C250.292 79.5405 206.365 52.7454 162.651 63.2189L164.515 70.9987C203.949 61.5506 243.576 85.7226 253.268 125.034L261.036 123.119ZM162.651 63.2189C118.937 73.6924 91.9225 117.484 102.093 161.2L109.885 159.387C100.71 119.952 125.081 80.4469 164.515 70.9987L162.651 63.2189ZM106.921 164.183L106.923 164.183L105.055 156.404L105.053 156.405L106.921 164.183ZM126.869 230.28L109.877 159.362L102.097 161.226L119.089 232.144L126.869 230.28ZM122.059 227.319L122.045 227.322L123.912 235.101L123.926 235.098L122.059 227.319ZM119.121 232.212C130.269 275.223 173.87 301.548 217.262 291.152L215.398 283.372C176.255 292.751 136.921 269.003 126.865 230.205L119.121 232.212ZM217.262 291.152C260.654 280.756 287.592 237.53 278.039 194.137L270.226 195.857C278.843 235 254.542 273.994 215.398 283.372L217.262 291.152ZM273.213 191.104L273.201 191.107L275.064 198.887L275.076 198.884L273.213 191.104ZM269.997 194.849L270.255 195.926L278.035 194.062L277.777 192.985L269.997 194.849Z\" fill=\"black\" mask=\"url(#path-4-inside-1)\"/>  </g>  <defs>  <clipPath id=\"clip0\">  <rect width=\"200\" height=\"320\" fill=\"white\" transform=\"translate(90 43)\"/>  </clipPath>  </defs></g></g><g id=\"dc-avatar-Shirt\"><path d=\"M229.552 330.449L229.692 330.481L229.836 330.493C275.961 334.297 303.62 354.785 323.694 383H50.3745C66.6742 353.658 89.8579 334.982 127.445 326.412C143.458 322.761 162.113 320.94 184 320.94C193.456 320.94 200.814 322.382 207.796 324.286C210.383 324.991 212.983 325.781 215.643 326.589C220.045 327.927 224.611 329.314 229.552 330.449Z\" fill=\"#0C4F2F\" stroke=\"black\" stroke-width=\"4\"/><path d=\"M115.93 328.581L125.083 308.984C125.301 308.516 125.845 308.294 126.332 308.466C164.258 321.891 198.761 320.946 230.735 312.045C231.138 311.933 231.568 312.081 231.814 312.418L245.747 331.471C246.129 331.995 245.934 332.733 245.33 332.97C211.723 346.167 148.662 343.923 116.414 329.904C115.903 329.682 115.694 329.087 115.93 328.581Z\" fill=\"#3d8160\" stroke=\"black\" stroke-width=\"4\"/></g><g id=\"dc-avatar-Eyes\"><ellipse cx=\"168.117\" cy=\"167.928\" rx=\"9\" ry=\"10\" transform=\"rotate(-6.77646 168.117 167.928)\" fill=\"black\"/><ellipse cx=\"232.148\" cy=\"157.924\" rx=\"9\" ry=\"10\" transform=\"rotate(-6.27568 232.148 157.924)\" fill=\"black\"/></g><g id=\"dc-avatar-Eyebrows\"><path d=\"M219 134.214C224.667 131.548 238 129.114 246 140.714\" stroke=\"black\" stroke-width=\"4\" stroke-linecap=\"round\"/><path d=\"M143.579 159.521C145.65 153.61 153.261 142.396 167.142 144.822\" stroke=\"black\" stroke-width=\"4\" stroke-linecap=\"round\"/><path d=\"M146.074 153.458L139.926 148.031\" stroke=\"black\" stroke-width=\"4\" stroke-linecap=\"round\"/><path d=\"M242.961 135.157L249.109 129.73\" stroke=\"black\" stroke-width=\"4\" stroke-linecap=\"round\"/><path d=\"M152.523 147.814L148.477 140.682\" stroke=\"black\" stroke-width=\"4\" stroke-linecap=\"round\"/><path d=\"M235.512 131.513L239.559 124.381\" stroke=\"black\" stroke-width=\"4\" stroke-linecap=\"round\"/><path d=\"M160.599 144.201L158.398 136.301\" stroke=\"black\" stroke-width=\"4\" stroke-linecap=\"round\"/><path d=\"M226.436 130.9L228.637 123\" stroke=\"black\" stroke-width=\"4\" stroke-linecap=\"round\"/></g><g id=\"dc-avatar-Mouth\"><path d=\"M206 221.696C210.167 219.363 227 216.396 227 223.196C227 231.696 215.5 231.196 215.5 231.196C215.5 231.196 228.545 228.035 226 237.196C223.5 246.196 216.5 242.696 214.5 241.696\" stroke=\"black\" stroke-width=\"4\"/></g><g id=\"dc-avatar-Nose\"><path d=\"M200.278 183.927C205.498 181.94 214.601 182.54 214.041 192.64C213.543 201.615 204.334 203.398 201.4 201.305\" stroke=\"black\" stroke-width=\"4\"/></g><g id=\"dc-avatar-Hair\"><path d=\"M182.788 48.4887L182.864 48.4969L182.941 48.4991C209.61 49.2835 230.342 59.8969 245.014 72.8493C259.07 85.2583 267.463 99.7231 270.2 109.582C266.14 111.899 259.186 113.893 250.315 115.528C240.64 117.312 229.022 118.615 217.169 119.544C193.462 121.401 168.979 121.749 157.543 121.5L151.47 121.368L156.277 125.083C158.774 127.013 162.099 128.356 165.615 129.3C169.157 130.252 173.034 130.835 176.747 131.167C180.571 131.509 184.299 131.589 187.388 131.51C176.801 139.672 163.326 145.948 150.039 150.6C134.693 155.973 119.769 159.12 110.21 160.521L108.061 160.836L108.552 162.952C111.899 177.381 118.052 202.603 122.179 219.519C124.011 227.025 125.443 232.895 126.054 235.463C127.138 240.017 130.552 246.508 134.449 252.491C138.042 258.008 142.233 263.38 145.771 266.687L137.933 298.5H108.372C116.71 285.787 118.47 271.097 116.769 255.517C114.929 238.653 109.008 220.513 102.766 202.35C102.152 200.562 101.534 198.774 100.917 196.986C95.2331 180.527 89.5649 164.113 86.4941 148.382C83.0927 130.958 82.9412 114.651 89.3269 100.314C99.6658 77.0999 117.993 63.6198 136.326 56.1911C154.702 48.745 172.946 47.4399 182.788 48.4887Z\" fill=\"#FC909F\" stroke=\"#171921\" stroke-width=\"4\"/></g><g id=\"dc-avatar-Ear\"><path d=\"M121.466 215.861L122 215.286V214.501V180.999V179.88L121.046 179.295C117.312 177.004 112.772 175.75 108.08 175.75C102.44 175.75 97.1591 177.497 93.3977 181.045C89.5942 184.632 87.5421 189.877 88.0869 196.416C88.6179 202.788 90.7569 207.477 94.3047 210.593C94.0134 211.592 93.9273 212.67 94.0624 213.803C94.4517 217.072 96.1039 219.427 98.6572 220.878C101.091 222.261 104.206 222.75 107.524 222.75C113.003 222.75 117.808 219.803 121.466 215.861Z\" stroke=\"black\" stroke-width=\"4\"/><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M127.972 196.734C128.043 196.082 128.08 195.42 128.08 194.75C128.08 184.533 118.573 177.75 108.08 177.75C97.5866 177.75 89.0801 184.25 90.08 196.25C90.6364 202.927 93.0258 207.322 96.7307 209.967C96.1423 210.991 95.8848 212.194 96.0483 213.567C96.6774 218.848 101.186 220.75 107.524 220.75C118.629 220.75 127.416 206.703 127.972 196.734Z\" fill=\"#AC6651\"/><path d=\"M112.5 186.25C108.5 184.417 99.7 183.45 96.5 194.25\" stroke=\"#171921\" stroke-width=\"4\"/><path d=\"M102 186.75C104.167 188.583 108.3 194.25 107.5 202.25\" stroke=\"#171921\" stroke-width=\"4\"/></g><g id=\"dc-avatar-Ear Ring\"><path d=\"M107 204C120.255 204 131 214.745 131 228C131 241.255 120.255 252 107 252C93.7452 252 83 241.255 83 228C83 221.609 86.5 216.5 89.5715 211.5L90.5 210\" stroke=\"#F4D150\" stroke-width=\"4\"/></g></svg>";
        ByteArrayInputStream in = new ByteArrayInputStream(svgRaw.getBytes(StandardCharsets.UTF_8));
        File tempFile = FileUtil.createTempFile(".png");
        FileOutputStream out = new FileOutputStream(tempFile);
        SvgUtil.toPng(in, out);
        System.out.println(tempFile.getAbsolutePath());
    }

}